<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <title>Registration page</title>
    <!-- <link rel="stylesheet" href="style.css" /> -->
  </head>
  <body>
    <h1>Create your account</h1>
    <div class="registerContainer">
      <div class="r_username">
        <span>Username: </span>
        <input
          id="r_username_input"
          type="text"
          placeholder="Only Alphanumeric is allowed"
        />
      </div>

      <div class="r_password">
        <span>Password: </span>
        <input
          id="r_password_input"
          type="text"
          placeholder="Enter your password"
        />
      </div>

      <div class="confirm_password">
        <span>Confirm Password: </span>
        <input
          id="confirm_password_input"
          type="text"
          placeholder="Retype your password"
        />
      </div>
    </div>

    <button id="create_account">Create Account</button>

    <script>
      const store = [];
      let active = localStorage.getItem("active");
      document.addEventListener("DOMContentLoaded", () => {
        let temp = JSON.parse(localStorage.getItem("store")) || [];
        temp.forEach((obj) => {
          store.push(obj);
        });
        active = localStorage.getItem("active") || "";
      });

      function createTaskElement(username, password) {
        let ob = {
          username: username,
          password: password,
          wallet: 0,
          transaction: [],
        };
        store.push(ob);
        localStorage.setItem("store", JSON.stringify(store)); // update immediately
      }

      const r_username = document.querySelectorAll("#r_username_input")[0];
      const r_password = document.querySelectorAll("#r_password_input")[0];
      const r_confirm = document.querySelectorAll("#confirm_password_input")[0];
      const createAccountBtn = document.querySelectorAll("#create_account")[0];
      createAccountBtn.addEventListener("click", () => {
        const r_username_input = r_username.value.trim();
        const r_pass_input = r_password.value;
        const confirm_pass = r_confirm.value;
        console.log(r_username_input);

        if (r_pass_input !== confirm_pass) {
          alert("Password didn't match");
          return;
        }

        let ok = false;
        store.forEach((obj) => {
          if (obj.username == r_username_input) { ok = true; }
        });

        if (ok == true) {
          alert("Username have to be unique.");
          return;
        }

        alert("Account created successfully");
        createTaskElement(r_username_input, r_pass_input);
      });
    </script>
  </body>
</html>